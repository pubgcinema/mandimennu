<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="styles.css"> <!-- Your styles -->
</head>
<body>

    <div class="checkout-container">
        <h2>Checkout</h2>

        <form id="checkout-form">
            <!-- User Info -->
            <div class="form-group">
                <label for="username">Full Name</label>
                <input type="text" id="username" name="username" required>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <!-- Cart and Table Info -->
            <div class="form-group">
                <label for="table-number">Table Number</label>
                <input type="text" id="table-number" name="table-number" required>
            </div>

            <div>
                <h3>Your Cart:</h3>
                <ul id="cart-items">
                    <!-- Cart items will be populated here -->
                </ul>
                <p><strong>Total Price: ₹<span id="total-price">0.00</span></strong></p>
            </div>

            <button type="submit" id="place-order-btn">Place Order</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cartItemsContainer = document.getElementById('cart-items');
            const totalPriceElement = document.getElementById('total-price');
            const placeOrderBtn = document.getElementById('place-order-btn');

            function loadCart() {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                cartItemsContainer.innerHTML = '';
                let total = 0;

                cart.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `${item.name} x ${item.quantity} - ₹${(item.price * item.quantity).toFixed(2)}`;
                    cartItemsContainer.appendChild(li);
                    total += item.price * item.quantity;
                });

                totalPriceElement.textContent = total.toFixed(2);
            }

            function clearCart() {
                localStorage.removeItem('cart');
            }

            document.getElementById('checkout-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const tableNumber = document.getElementById('table-number').value.trim();

                if (tableNumber === '') {
                    alert('Please enter your table number.');
                    return;
                }

                // Collect cart details
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                let cartDetails = cart.map(item => `${item.name} x ${item.quantity}`).join(", ");
                let totalPrice = totalPriceElement.textContent;

                placeOrderBtn.innerHTML = 'Placing Order...'; // feedback to user
                placeOrderBtn.disabled = true;

                // Google Form submission URL and field IDs (replace with your own)
                const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSc-9tbIJ9VUDx8HFfLAOQI9m5buXjRSevQruJWloxizlW9wYg/viewform?usp=header'; // Replace with your form's action URL
                const NAME_FIELD_ID = 'entry.1234567890'; // Replace with Name field ID
                const EMAIL_FIELD_ID = 'entry.2345678901'; // Replace with Email field ID
                const PHONE_FIELD_ID = 'entry.3456789012'; // Replace with Phone field ID
                const TABLE_FIELD_ID = 'entry.4567890123'; // Replace with Table Number field ID
                const CART_FIELD_ID = 'entry.5678901234'; // Replace with Cart Details field ID
                const TOTAL_FIELD_ID = 'entry.6789012345'; // Replace with Total Price field ID

                // Collect user info from the form
                const username = document.getElementById('username').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const email = document.getElementById('email').value.trim();

                if (!username || !email) {
                    alert('Please fill out all required fields.');
                    placeOrderBtn.innerHTML = 'Place Order';
                    placeOrderBtn.disabled = false;
                    return;
                }

                // Prepare form data for Google Form
                const formData = new FormData();
                formData.append(NAME_FIELD_ID, username);
                formData.append(EMAIL_FIELD_ID, email);
                formData.append(PHONE_FIELD_ID, phone);
                formData.append(TABLE_FIELD_ID, tableNumber);
                formData.append(CART_FIELD_ID, cartDetails);
                formData.append(TOTAL_FIELD_ID, totalPrice);

                try {
                    // Send POST request to Google Form
                    await fetch(GOOGLE_FORM_URL, {
                        method: 'POST',
                        body: formData,
                        mode: 'no-cors' // Required for Google Forms
                    });

                    setTimeout(() => {
                        alert('Order placed successfully!');
                        clearCart();
                        window.location.href = '../index.html';
                    }, 1000);
                } catch (error) {
                    console.error('Error submitting form:', error);
                    alert('There was an error placing your order. Please try again.');
                    placeOrderBtn.innerHTML = 'Place Order';
                    placeOrderBtn.disabled = false;
                }
            });

            loadCart();
        });
    </script>
</body>
</html>
